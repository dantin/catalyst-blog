---
title: Catalan数列
date: 2016-12-30 14:50:49
categories: 学术
tags: Math
toc: true
mathjax: true
---

卡特兰数（Catalan number）是组合数学中一个重要的计数数列，在很多看似毫不相关地方都能见到它的身影。

这篇文章介绍卡特兰数的几个应用以及其推导过程，用组合推理的方式推导出Catalan数的公式。

### 带限制条件的路径总数

首先我们来看一个问题：

在一个平面直角坐标系中，只能往右或往上走一个单位长度，问有多少种不同的路径可以从左下角$(1,1)$走到右上角$(n,n)$，并且要求路径不能经过直线$y = x$上方的点。

下图中的路径都是合法的：

```
+--+--+--+--+   +--+--+--+--+   +--+--+--+--+   +--+--+--+--+
|  |  |  |  ^   |  |  |  |  ^   |  |  |  |  ^   |  |  |  |  ^
+--+--+--+--+   +--+--+--+--+   +--+--+--+--+   +--+--+--+--+
|  |  |  |  ^   |  |  |  |  ^   |  |  |  |  ^   |  |  |  |  ^
+--+--+--+--+   +--+--+--+--+   +--+--+--+->+   +--+--+--+--+
|  |  |  |  ^   |  |  |  |  ^   |  |  |  ^  |   |  |  |  |  ^
+--+--+--+--+   +--+--+--+->+   +--+--+--+--+   +--+--+->+->+
|  |  |  |  ^   |  |  |  ^  |   |  |  |  ^  |   |  |  ^  |  |
+->+->+->+->+   +->+->+->+--+   +->+->+->+--+   +->+->+--+--+

+--+--+--+--+   +--+--+--+--+   +--+--+--+--+   +--+--+--+--+
|  |  |  |  ^   |  |  |  |  ^   |  |  |  |  ^   |  |  |  |  ^
+--+--+--+--+   +--+--+--+--+   +--+--+--+->+   +--+--+--+->+
|  |  |  |  ^   |  |  |  |  ^   |  |  |  ^  |   |  |  |  ^  |
+--+--+--+--+   +--+--+--+->+   +--+--+--+--+   +--+--+--+--+
|  |  |  |  ^   |  |  |  ^  |   |  |  |  ^  |   |  |  |  ^  |
+--+->+->+->+   +--+--+->+--+   +--+--+--+--+   +--+->+->+--+
|  ^  |  |  |   |  |  ^  |  |   |  |  |  ^  |   |  ^  |  |  |
+->+--+--+--+   +->+->+--+--+   +->+->+->+--+   +->+--+--+--+

+--+--+--+--+   +--+--+--+--+   +--+--+--+--+   +--+--+--+--+
|  |  |  |  ^   |  |  |  |  ^   |  |  |  |  ^   |  |  |  |  ^
+--+--+--+--+   +--+--+--+->+   +--+--+--+->+   +--+--+--+->+
|  |  |  |  ^   |  |  |  ^  |   |  |  |  ^  |   |  |  |  ^  |
+--+--+->+->+   +--+--+--+--+   +--+--+->+--+   +--+--+--+--+
|  |  ^  |  |   |  |  |  ^  |   |  |  ^  |  |   |  |  |  ^  |
+--+--+--+--+   +--+--+->+--+   +--+--+--+--+   +--+->+->+--+
|  |  ^  |  |   |  |  ^  |  |   |  |  ^  |  |   |  ^  |  |  |
+->+->+--+--+   +->+->+--+--+   +->+->+--+--+   +->+--+--+--+

+--+--+--+--+   +--+--+--+--+
|  |  |  |  ^   |  |  |  |  ^
+--+--+--+--+   +--+--+--+->+
|  |  |  |  ^   |  |  |  ^  |
+--+--+->+->+   +--+--+->+--+
|  |  ^  |  |   |  |  ^  |  |
+--+->+--+--+   +--+->+--+--+
|  ^  |  |  |   |  ^  |  |  |
+->+--+--+--+   +->+--+--+--+
```

如果没有限制条件，那么从左下角走到右上角一共有$2n$步，有$n$步是往右，另外$n$步是往上，那么路径方案数就是$2n$步中选择$n$步往右，一共有$\dbinom{n}{2n}$（即$C_{2n}^n$）种方案。

那么我们考虑一下这里面有多少种方案是不合法的。

首先对于每一种不合法的方案，它的路径一定与$y=x+1$有交。我们找到它与$y=x+1$的第一个交点，然后将这个点后面部分的路径关于$y=x+1$做一个对称。由于原来路径到达$(n,n)$，新的对称之后的路径就会到达$(n−1,n+1)$。这样我们把每一种不合法方案都对应到了一条从$(1,1)$到$(n−1,n+1)$的路径，现在再来看是否每一条这样的路径都能对应到一种不合法方案，如果是，那么这就建立了一个一一映射的关系，也就是它们的方案总数相同。这是肯定的，因为每一条这样的路径必定与$y=x+1$有交，那么对称回去，就得到一条不合法方案

从$(1,1)$到$(n−1,n+1)$的路径有$\dbinom{n-1+n+1}{n-1}$条，那么合法的方案就是

{% math %}
\begin{aligned}
C_n = \dbinom{2n}{n} - \dbinom{2n}{n-1} = \frac{1}{n+1}\dbinom{2n}{n}
\end{aligned}
{% endmath %}

我们把这个方案数记为$C_n$，这就是著名的Catalan数。

### 括号序列计数

再来看一个问题：有多少种不同的长度为$n$的括号序列？

首先一个括号序列是指`(), ()(), (())()`这样的由括号组成的序列，并且没有左右括号无法匹配的情况。

我们可以将长度为$2n$的括号序列映射成刚刚所说的路径：首先对于左括号，那么就向右走一个单位长度，对于右括号，那么就向上走一个单位长度，由于括号序列合法，那么每次向右走的次数不会少于向上的次数，也就是这条路径不会在$y=x$之上。再考虑每一条这样的路径，也能够对应到一种合法的括号序列，因此，长度为$2n$的括号序列的方案数就是$C_n$。

### 出栈顺序

现在来考虑你有$n$个元素（元素之间是没有区别的）和一个栈，每次可以将一个元素入栈，或者将栈顶元素弹出，问有多少种可能的操作序列，这可以将问题对应成括号序列，入栈为左括号，出栈为右括号，因此方案数也是$C_n$。

### 排队问题

现在有$2n$个人，他们身高互不相同，他们要成两排，每一排有$n$个人，并且满足每一排必须是从矮到高，且后一排的人要比前一排对应的人要高，问有多少种排法？

我们考虑先把这些人从矮到高排成一排，那么现在来分配哪个人在前，哪个人在后，例如有6个人，身高是1, 2, 3, 4, 5, 6

那么我们用1表示这个人应该在后排，0表示这个人应该在前排，例如说100110表示两排分别是2, 3, 6和1, 4, 5这是不合法的

那么合法方案应该是怎么样的呢？后排要比前排对应的人高，也就是说0的出现次数在每一个地方都不应该小于1，这恰恰又是一个括号序列，因此，方案仍然是Catalan数。
